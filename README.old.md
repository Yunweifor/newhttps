# NewHTTPS - ç‹¬ç«‹SSLè¯ä¹¦è‡ªåŠ¨åŒ–ç®¡ç†ç³»ç»Ÿ

## é¡¹ç›®æ¦‚è¿°

NewHTTPS æ˜¯ä¸€ä¸ª**å®Œå…¨ç‹¬ç«‹**çš„SSLè¯ä¹¦è‡ªåŠ¨åŒ–ç®¡ç†ç³»ç»Ÿï¼Œèåˆäº†ä¼˜ç§€å¼€æºé¡¹ç›®çš„æ ¸å¿ƒæ€æƒ³ï¼š
- å€Ÿé‰´ **Certd-2** çš„è¯ä¹¦ç”³è¯·å’Œç®¡ç†ç†å¿µ
- é‡‡ç”¨ **httpsok.sh** çš„å¯é æœ¬åœ°éƒ¨ç½²æœºåˆ¶
- æä¾›å®Œæ•´çš„ç‹¬ç«‹è§£å†³æ–¹æ¡ˆï¼Œæ— éœ€ä¾èµ–å¤–éƒ¨ç³»ç»Ÿ

### æ ¸å¿ƒç‰¹æ€§

1. **ç‹¬ç«‹è¯ä¹¦ç”³è¯·**: å†…ç½®å®Œæ•´çš„ ACME å®¢æˆ·ç«¯
   - æ”¯æŒ Let's Encryptã€ZeroSSLã€Google Trust Services ç­‰å¤šä¸ª CA æœºæ„
   - æ”¯æŒ DNS-01ã€HTTP-01 éªŒè¯æ–¹å¼
   - æ”¯æŒé€šé…ç¬¦åŸŸåå’Œå¤šåŸŸåè¯ä¹¦
   - æ— éœ€ä¾èµ– Docker æˆ–å¤–éƒ¨ Certd-2 å®ä¾‹

2. **å¯é æœ¬åœ°éƒ¨ç½²**: åŸºäº httpsok.sh çš„éƒ¨ç½²æœºåˆ¶
   - è‡ªåŠ¨æ£€æµ‹ Nginx é…ç½®
   - æ™ºèƒ½è¯ä¹¦æ–‡ä»¶æ›¿æ¢
   - è‡ªåŠ¨ Nginx é‡è½½
   - å®Œæ•´çš„å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

3. **çµæ´»éƒ¨ç½²æ¶æ„**:
   - **ç‹¬ç«‹æ¨¡å¼**ï¼šå®Œå…¨è‡ªåŒ…å«çš„è¯ä¹¦ç®¡ç†ç³»ç»Ÿ
   - **é›†æˆæ¨¡å¼**ï¼šå¯é€‰æ‹©ä¸ç°æœ‰ Certd-2 é›†æˆ
   - **æ··åˆæ¨¡å¼**ï¼šæ”¯æŒå¤šç§éƒ¨ç½²ç­–ç•¥

## æ¶æ„è®¾è®¡

### æ–¹æ¡ˆä¸€ï¼šå®Œå…¨ç‹¬ç«‹éƒ¨ç½²ï¼ˆæ¨èï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NewHTTPS Web   â”‚    â”‚  NewHTTPS API   â”‚    â”‚ Local Agent     â”‚
â”‚  è¯ä¹¦ç®¡ç†ç•Œé¢    â”‚â—„â”€â”€â–ºâ”‚  è¯ä¹¦ç”³è¯·+ç®¡ç†   â”‚â—„â”€â”€â–ºâ”‚ æœ¬åœ°éƒ¨ç½²ä»£ç†     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚  Nginx Server   â”‚
                                               â”‚  ç›®æ ‡æœåŠ¡å™¨     â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–¹æ¡ˆäºŒï¼šä¸ç°æœ‰ Certd-2 é›†æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Certd-2 Web   â”‚    â”‚  NewHTTPS API   â”‚    â”‚ Local Agent     â”‚
â”‚   ç®¡ç†ç•Œé¢       â”‚â—„â”€â”€â–ºâ”‚   ä¸­é—´å±‚        â”‚â—„â”€â”€â–ºâ”‚ æœ¬åœ°éƒ¨ç½²ä»£ç†     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚  Nginx Server   â”‚
                                               â”‚  ç›®æ ‡æœåŠ¡å™¨     â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç›®å½•ç»“æ„

```
newhttps/
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ api/                      # API ä¸­é—´å±‚
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ agent/                    # æœ¬åœ°éƒ¨ç½²ä»£ç†
â”‚   â”œâ”€â”€ newhttps-agent.sh     # ä¸»è¦è„šæœ¬
â”‚   â”œâ”€â”€ config/               # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â”œâ”€â”€ plugins/                  # Certd-2 æ’ä»¶æ‰©å±•
â”‚   â””â”€â”€ newhttps-deploy/      # æ–°çš„éƒ¨ç½²æ’ä»¶
â””â”€â”€ docs/                     # æ–‡æ¡£
    â”œâ”€â”€ install.md            # å®‰è£…æŒ‡å—
    â”œâ”€â”€ config.md             # é…ç½®è¯´æ˜
    â””â”€â”€ api.md                # API æ–‡æ¡£
```

## å·¥ä½œæµç¨‹

1. **è¯ä¹¦ç”³è¯·é˜¶æ®µ**:
   - ç”¨æˆ·åœ¨ Certd-2 Web ç•Œé¢åˆ›å»ºè¯ä¹¦ç”³è¯·æµæ°´çº¿
   - ç³»ç»Ÿè‡ªåŠ¨ç”³è¯·è¯ä¹¦å¹¶å­˜å‚¨

2. **è¯ä¹¦åˆ†å‘é˜¶æ®µ**:
   - NewHTTPS API æä¾›è¯ä¹¦ä¸‹è½½æ¥å£
   - æœ¬åœ° Agent å®šæœŸæ£€æŸ¥è¯ä¹¦æ›´æ–°

3. **è¯ä¹¦éƒ¨ç½²é˜¶æ®µ**:
   - Agent ä¸‹è½½æ–°è¯ä¹¦
   - è‡ªåŠ¨æ£€æµ‹ Nginx é…ç½®
   - å¤‡ä»½æ—§è¯ä¹¦å¹¶æ›¿æ¢æ–°è¯ä¹¦
   - æµ‹è¯•é…ç½®å¹¶é‡è½½ Nginx

## å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šç‹¬ç«‹å®‰è£…ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

é€‚ç”¨äº AlimaLinux 9ã€CentOSã€RHEL ç­‰ Linux ç³»ç»Ÿï¼š

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/newhttps.git
cd newhttps

# è¿è¡Œå®‰è£…å‰æ£€æŸ¥ï¼ˆæ¨èï¼‰
chmod +x pre-install-check.sh
sudo ./pre-install-check.sh

# è¿è¡Œç‹¬ç«‹å®‰è£…è„šæœ¬ï¼ˆéœ€è¦ root æƒé™ï¼‰
chmod +x standalone-install.sh
sudo ./standalone-install.sh
```

> ğŸ“‹ **AlimaLinux 9 ç”¨æˆ·**: è¯·å‚è€ƒ [AlimaLinux å®‰è£…æŒ‡å—](docs/almalinux-install.md) è·å–è¯¦ç»†çš„å®‰è£…æ­¥éª¤å’Œæ•…éšœæ’é™¤æ–¹æ³•ã€‚

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…

#### 1. å®‰è£… Certd-2 (å¦‚æœè¿˜æ²¡æœ‰)
```bash
# ä½¿ç”¨ Docker å®‰è£… Certd-2
docker run -d --name certd \
  -p 7001:7001 \
  -v /data/certd:/app/data \
  registry.cn-shenzhen.aliyuncs.com/handsfree/certd:latest
```

#### 2. éƒ¨ç½² NewHTTPS API
```bash
cd newhttps/api
npm install
npm run build
npm start
```

#### 3. å®‰è£…æœ¬åœ° Agent
```bash
cd newhttps/agent
chmod +x newhttps-agent.sh
./newhttps-agent.sh --install
./newhttps-agent.sh --config
```

### æ–¹æ³•ä¸‰ï¼šDocker Compose éƒ¨ç½²

#### å¿«é€Ÿå¯åŠ¨ï¼ˆæ¨èï¼‰
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/newhttps.git
cd newhttps

# ä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬
chmod +x docker-start.sh
./docker-start.sh --standalone
```

#### æ‰‹åŠ¨å¯åŠ¨
```bash
# ç‹¬ç«‹æ¨¡å¼ï¼ˆæ¨èï¼‰
docker-compose -f docker-compose.standalone.yml up -d

# é›†æˆæ¨¡å¼ï¼ˆä¸ Certd-2 é›†æˆï¼‰
docker-compose up -d
```

## é…ç½®è¯´æ˜

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒ [é…ç½®æ–‡æ¡£](docs/config.md)

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚
