# NewHTTPS

NewHTTPS æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ SSL è¯ä¹¦è‡ªåŠ¨åŒ–ç®¡ç†å¹³å°ï¼Œä¸“ä¸ºç®€åŒ– HTTPS è¯ä¹¦çš„ç”³è¯·ã€éƒ¨ç½²å’Œç»­æœŸè€Œè®¾è®¡ã€‚é‡‡ç”¨ä¼˜åŒ–çš„ Docker å®¹å™¨åŒ–æ¶æ„ï¼Œæ”¯æŒä»å•æœºåˆ°åˆ†å¸ƒå¼çš„å¤šç§éƒ¨ç½²æ¨¡å¼ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **ğŸ”„ è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†** - æ”¯æŒ Let's Encryptã€ZeroSSL ç­‰å¤šç§ CA
- **ğŸš€ æ™ºèƒ½éƒ¨ç½²** - è‡ªåŠ¨éƒ¨ç½²è¯ä¹¦åˆ° Nginxã€Apache ç­‰ Web æœåŠ¡å™¨
- **ğŸŒ å¤šæœåŠ¡å™¨æ”¯æŒ** - é€šè¿‡ Agent ç®¡ç†å¤šå°æœåŠ¡å™¨çš„è¯ä¹¦
- **ğŸ’» Web ç®¡ç†ç•Œé¢** - ç›´è§‚çš„ Vue.js + TypeScript å‰ç«¯ç•Œé¢
- **ğŸ”Œ RESTful API** - å®Œæ•´çš„ API æ¥å£ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹é›†æˆ
- **ğŸ“Š å®æ—¶ç›‘æ§** - è¯ä¹¦çŠ¶æ€ç›‘æ§å’Œåˆ°æœŸæé†’
- **ğŸ”’ å®‰å…¨å¯é ** - JWT è®¤è¯ã€æƒé™æ§åˆ¶ã€æ•°æ®åŠ å¯†
- **ğŸ“¦ ä¼˜åŒ–å®¹å™¨åŒ–** - å¤šé˜¶æ®µæ„å»ºï¼Œ71%é•œåƒå‡å°‘ï¼Œ85%æ„å»ºåŠ é€Ÿ
- **ğŸ” è‡ªåŠ¨å‘ç°** - Agent è‡ªåŠ¨æ£€æµ‹ SSL è¯ä¹¦é…ç½®
- **âš¡ é›¶åœæœºæ›´æ–°** - çƒ­é‡è½½ Web æœåŠ¡å™¨ï¼Œä¸å½±å“ä¸šåŠ¡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æœåŠ¡ç«¯ (Docker)           â”‚    â”‚        å®¢æˆ·ç«¯æœåŠ¡å™¨           â”‚
â”‚                                â”‚    â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ NewHTTPS API (Port 3000)   â”‚ â”‚â—„â”€â”€â”€â”¤  â”‚ newhttps-agent.sh       â”‚  â”‚
â”‚  â”‚ - è¯ä¹¦ç®¡ç†API               â”‚ â”‚    â”‚  â”‚ - è‡ªåŠ¨æ£€æµ‹Nginxé…ç½®      â”‚  â”‚
â”‚  â”‚ - Agenté€šä¿¡æ¥å£             â”‚ â”‚    â”‚  â”‚ - æ£€æµ‹SSLè¯ä¹¦è·¯å¾„        â”‚  â”‚
â”‚  â”‚ - å¥åº·æ£€æŸ¥ /health          â”‚ â”‚    â”‚  â”‚ - ä¸APIé€šä¿¡æ£€æŸ¥æ›´æ–°      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚  â”‚ - è‡ªåŠ¨ä¸‹è½½éƒ¨ç½²æ–°è¯ä¹¦     â”‚  â”‚
â”‚                                â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚                             â”‚
â”‚  â”‚ Web UI (Port 8080)         â”‚ â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ - Vue.jsç®¡ç†ç•Œé¢            â”‚ â”‚    â”‚  â”‚ Nginx + SSLè¯ä¹¦         â”‚  â”‚
â”‚  â”‚ - è¯ä¹¦å¯è§†åŒ–ç®¡ç†            â”‚ â”‚    â”‚  â”‚ - è‡ªåŠ¨ç»­æœŸ               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚  â”‚ - é›¶åœæœºæ›´æ–°             â”‚  â”‚
â”‚                                â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ Nginx Proxy (Port 80)      â”‚ â”‚
â”‚  â”‚ - åå‘ä»£ç†                  â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ - è´Ÿè½½å‡è¡¡                  â”‚ â”‚    â”‚        æ›´å¤šå®¢æˆ·ç«¯æœåŠ¡å™¨       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  Agent + Apache/Nginx...    â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚

| éƒ¨ç½²æ¨¡å¼ | å†…å­˜éœ€æ±‚ | ç£ç›˜ç©ºé—´ | é€‚ç”¨åœºæ™¯ |
|----------|----------|----------|----------|
| æ ‡å‡†æ¨¡å¼ | 2GB+ | 10GB+ | ç”Ÿäº§ç¯å¢ƒ |
| æœ€å°åŒ–æ¨¡å¼ | 1GB | 5GB+ | VPS/æµ‹è¯• |
| APIä¸“ç”¨ | 512MB | 3GB+ | å¾®æœåŠ¡ |

**åŸºç¡€è¦æ±‚**: Docker 20.10+, Docker Compose 2.0+

### ğŸ¯ æ¨èéƒ¨ç½²æ–¹å¼

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Yunweifor/newhttps.git
cd newhttps

# æ ‡å‡†éƒ¨ç½²ï¼ˆæ¨èï¼‰
make standalone

# æœ€å°åŒ–éƒ¨ç½²ï¼ˆ1GBå†…å­˜æœåŠ¡å™¨ï¼‰
make standalone-minimal

# APIä¸“ç”¨éƒ¨ç½²
make standalone-api
```

### ğŸ› ï¸ é«˜çº§éƒ¨ç½²é€‰é¡¹

```bash
# è‡ªå®šä¹‰é…ç½®éƒ¨ç½²
./scripts/standalone-deploy.sh install --standard \
  --domain yourdomain.com \
  --email admin@yourdomain.com \
  --port 3001

# å¼€å‘ç¯å¢ƒ
make dev

# ç”Ÿäº§ç¯å¢ƒï¼ˆå¸¦å¤‡ä»½ï¼‰
make prod
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
newhttps/
â”œâ”€â”€ api/                           # API æœåŠ¡ (Node.js + TypeScript)
â”‚   â”œâ”€â”€ src/                      # æºä»£ç 
â”‚   â”œâ”€â”€ Dockerfile.optimized      # ä¼˜åŒ–çš„å¤šé˜¶æ®µæ„å»º
â”‚   â””â”€â”€ package.json              # ä¾èµ–é…ç½®
â”œâ”€â”€ web/                          # Web ç•Œé¢ (Vue.js + TypeScript)
â”‚   â”œâ”€â”€ src/                      # Vue.js æºä»£ç 
â”‚   â”œâ”€â”€ Dockerfile.optimized      # ä¼˜åŒ–çš„å¤šé˜¶æ®µæ„å»º
â”‚   â””â”€â”€ package.json              # ä¾èµ–é…ç½®
â”œâ”€â”€ agent/                        # å®¢æˆ·ç«¯ Agent è„šæœ¬
â”‚   â””â”€â”€ newhttps-agent.sh         # è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ scripts/                      # è‡ªåŠ¨åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ build.sh                  # æ™ºèƒ½æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh                 # é›¶åœæœºéƒ¨ç½²
â”‚   â”œâ”€â”€ standalone-deploy.sh      # å•æœºéƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ local-ci.sh              # æœ¬åœ°CI/CD
â”‚   â””â”€â”€ setup-git-hooks.sh       # Gité’©å­è®¾ç½®
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ standalone-deployment-guide.md  # å•æœºéƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ github-actions-setup.md         # CI/CDè®¾ç½®
â”‚   â”œâ”€â”€ usage.md                        # ä½¿ç”¨æŒ‡å—
â”‚   â””â”€â”€ troubleshooting.md              # æ•…éšœæ’é™¤
â”œâ”€â”€ Dockerfile.base               # åŸºç¡€é•œåƒ
â”œâ”€â”€ docker-compose.standalone.yml # å•æœºéƒ¨ç½²é…ç½®
â”œâ”€â”€ docker-compose.minimal.yml   # æœ€å°åŒ–éƒ¨ç½²é…ç½®
â”œâ”€â”€ docker-compose.dev.yml       # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ Makefile                      # ä¾¿æ·å‘½ä»¤
â””â”€â”€ .env.optimized               # ä¼˜åŒ–çš„ç¯å¢ƒé…ç½®æ¨¡æ¿
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

å¤åˆ¶å¹¶ç¼–è¾‘ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š

```bash
# ä½¿ç”¨ä¼˜åŒ–çš„é…ç½®æ¨¡æ¿
cp .env.optimized .env
vim .env
```

**æ ¸å¿ƒé…ç½®é¡¹**ï¼š

```bash
# å®‰å…¨é…ç½®ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET=your-super-secret-jwt-key-change-this

# æœåŠ¡é…ç½®
API_PORT=3000
WEB_PORT=8080
NODE_ENV=production

# åŸŸåé…ç½®
DOMAIN=yourdomain.com
EMAIL=admin@yourdomain.com

# æ€§èƒ½é…ç½®
RATE_LIMIT_MAX_REQUESTS=100
UPLOAD_MAX_SIZE=10485760
```

### æœåŠ¡è®¿é—®åœ°å€

- **API æœåŠ¡**: `http://localhost:3000`
- **Web ç•Œé¢**: `http://localhost:8080`
- **å¥åº·æ£€æŸ¥**: `http://localhost:3000/health`
- **API æ–‡æ¡£**: `http://localhost:3000/api/docs`

## ğŸ¤– Agent éƒ¨ç½²

åœ¨éœ€è¦ç®¡ç†SSLè¯ä¹¦çš„æœåŠ¡å™¨ä¸Šå®‰è£…Agentï¼š

```bash
# ä¸‹è½½Agentè„šæœ¬
wget https://raw.githubusercontent.com/Yunweifor/newhttps/main/agent/newhttps-agent.sh
chmod +x newhttps-agent.sh

# å®‰è£…Agent
./newhttps-agent.sh --install

# é…ç½®APIè¿æ¥
./newhttps-agent.sh --config

# è®¾ç½®å®šæ—¶ä»»åŠ¡
./newhttps-agent.sh --cron
```

### Agent åŠŸèƒ½

- **ğŸ” è‡ªåŠ¨å‘ç°**: è‡ªåŠ¨æ£€æµ‹Nginxé…ç½®å’ŒSSLè¯ä¹¦è·¯å¾„
- **ğŸ“¡ APIé€šä¿¡**: ä¸NewHTTPS APIé€šä¿¡æ£€æŸ¥è¯ä¹¦æ›´æ–°
- **ğŸ“œ è¯ä¹¦ç®¡ç†**: è‡ªåŠ¨ä¸‹è½½ã€éªŒè¯å’Œéƒ¨ç½²æ–°è¯ä¹¦
- **ğŸ”„ å®‰å…¨éƒ¨ç½²**: å¤‡ä»½æ—§è¯ä¹¦ã€åŸå­æ€§æ›¿æ¢ã€è‡ªåŠ¨å›æ»š
- **â° å®šæ—¶ä»»åŠ¡**: æ”¯æŒcronå®šæ—¶æ‰§è¡Œï¼ŒéšæœºåŒ–é¿å…å¹¶å‘

## ğŸ“Š ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# æ›´æ–°æœåŠ¡
git pull
docker-compose build --no-cache
docker-compose up -d
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tlnp | grep :3000
   
   # ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„ç«¯å£é…ç½®
   ```

2. **æƒé™é—®é¢˜**
   ```bash
   # æ£€æŸ¥æ•°æ®ç›®å½•æƒé™
   ls -la data/
   
   # ä¿®å¤æƒé™
   sudo chown -R 1001:1001 data/
   ```

3. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   docker-compose logs newhttps-api
   
   # é‡æ–°æ„å»ºé•œåƒ
   docker-compose build --no-cache
   ```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–æˆæœ

### Docker ä¼˜åŒ–æ•ˆæœ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| é•œåƒå¤§å° | 1.4GB | 400MB | **71%å‡å°‘** |
| ä»£ç å˜æ›´æ„å»º | 8-12åˆ†é’Ÿ | 1-2åˆ†é’Ÿ | **85-90%åŠ é€Ÿ** |
| ä¾èµ–å˜æ›´æ„å»º | 8-12åˆ†é’Ÿ | 3-4åˆ†é’Ÿ | **60-67%åŠ é€Ÿ** |
| CI/CDæ„å»º | 10-15åˆ†é’Ÿ | 4-6åˆ†é’Ÿ | **60-67%åŠ é€Ÿ** |

### éƒ¨ç½²æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | å†…å­˜å ç”¨ | å¯åŠ¨æ—¶é—´ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|----------|
| æ ‡å‡†æ¨¡å¼ | ~512MB | 30-40ç§’ | ç”Ÿäº§ç¯å¢ƒ |
| æœ€å°åŒ–æ¨¡å¼ | ~320MB | 20-30ç§’ | VPS/æµ‹è¯• |
| APIä¸“ç”¨ | ~256MB | 15-25ç§’ | å¾®æœåŠ¡ |

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†é’¥**
   ```bash
   # ç”ŸæˆéšæœºJWTå¯†é’¥
   openssl rand -base64 32
   ```

2. **ä½¿ç”¨HTTPS**
   - é…ç½®SSLè¯ä¹¦
   - å¯ç”¨HTTPSé‡å®šå‘

3. **ç½‘ç»œå®‰å…¨**
   - é…ç½®é˜²ç«å¢™
   - é™åˆ¶è®¿é—®IP

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ“š æ–‡æ¡£å¯¼èˆª

- **[å•æœºéƒ¨ç½²æŒ‡å—](docs/standalone-deployment-guide.md)** - è¯¦ç»†çš„å•æœºéƒ¨ç½²è¯´æ˜
- **[GitHub Actionsè®¾ç½®](docs/github-actions-setup.md)** - CI/CDæµæ°´çº¿é…ç½®
- **[Agentä½¿ç”¨è¯´æ˜](agent/README.md)** - å®¢æˆ·ç«¯Agentéƒ¨ç½²å’Œä½¿ç”¨
- **[ä½¿ç”¨æŒ‡å—](docs/usage.md)** - åŠŸèƒ½ä½¿ç”¨å’ŒAPIè¯´æ˜
- **[æ•…éšœæ’é™¤](docs/troubleshooting.md)** - å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ› ï¸ å¼€å‘å’Œç®¡ç†

### å¸¸ç”¨å‘½ä»¤

```bash
# æœåŠ¡ç®¡ç†
make status          # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
make logs           # æŸ¥çœ‹æ—¥å¿—
make health         # å¥åº·æ£€æŸ¥
make backup         # å¤‡ä»½æ•°æ®

# å¼€å‘ç›¸å…³
make dev            # å¼€å‘ç¯å¢ƒ
make test           # è¿è¡Œæµ‹è¯•
make lint           # ä»£ç æ£€æŸ¥
make clean          # æ¸…ç†ç¼“å­˜

# æ„å»ºç›¸å…³
make build          # æ„å»ºæ‰€æœ‰æœåŠ¡
make build-api      # ä»…æ„å»ºAPI
make build-web      # ä»…æ„å»ºWeb
```

### æœ¬åœ°CI/CD

```bash
# è®¾ç½®Gité’©å­è‡ªåŠ¨åŒ–
./scripts/setup-git-hooks.sh

# æœ¬åœ°CI/CDæµç¨‹
./scripts/local-ci.sh full --env prod

# å•ç‹¬æ‰§è¡Œå„é˜¶æ®µ
./scripts/local-ci.sh check      # ä»£ç æ£€æŸ¥
./scripts/local-ci.sh build      # æ„å»ºé•œåƒ
./scripts/local-ci.sh test       # è¿è¡Œæµ‹è¯•
./scripts/local-ci.sh security   # å®‰å…¨æ‰«æ
```

---

**NewHTTPS - è®©SSLè¯ä¹¦ç®¡ç†å˜å¾—ç®€å•ï¼** ğŸš€âœ¨
